package com.server.cms.service;

import com.server.cms.domain.CpUser;
import com.server.cms.framework.common.Unique;
import com.server.cms.repository.UserRepository;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit.jupiter.SpringExtension;
import org.springframework.transaction.annotation.Transactional;

import java.util.Base64;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

@SpringBootTest
@Transactional
class UserServiceTest {

    @Autowired
    private UserRepository userRepository;

    @Value("${directory.content}")
    private String IMG_PATH;


    @Test
    @DisplayName("연결 테스트")
    @Transactional
    void save_test() {
        CpUser cpUser = CpUser.create();
        CpUser save = userRepository.save(cpUser);
        System.out.println(save.getId());
    }

    @Test
    @DisplayName("인코딩 테스트")
    void base64encoding() {
        String ind = "00001";
        String s = Base64.getEncoder().encodeToString(ind.getBytes());
        String s1 = s.replaceAll("=", "");
        System.out.println(s1);
    }

    @Test
    @DisplayName("유니크 넘버 테스트")
    void UniqueNumberTest() {
        String number = Unique.UniqueNumber();
        System.out.println(number);
    }


    @Test
    @DisplayName("이미지 추출")
    void image() {
        String text = "<p style=\"text-align: center;\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/001202312200847427739.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/002202312200847424289.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/003202312200847427578.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/004202312200847427549.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/005202312200847428784.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/006202312200847421018.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/007202312200847420646.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/008202312200847427530.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/009202312200847424948.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/010202312200847428609.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/011202312200847421192.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/012202312200847424261.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/013202312200847423217.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/014202312200847427229.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/015202312200847420169.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/016202312200847421324.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/017202312200847427176.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/018202312200847428126.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/019202312200847421684.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/020202312200847427648.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/021202312200847426103.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/022202312200847422905.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/023202312200847434514.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/024202312200847430498.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/025202312200847438309.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/026202312200847436645.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/027202312200847436551.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/028202312200847432408.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/029202312200847435633.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/030202312200847432916.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/031202312200847434016.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/032202312200847435323.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/033202312200847431002.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/034202312200847437909.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/035202312200847430475.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/036202312200847436258.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/037202312200847435110.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/038202312200847437203.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/039202312200847436920.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/040202312200847432946.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/041202312200847438816.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/042202312200847433754.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/043202312200847434329.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/044202312200847436763.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/045202312200847448062.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/046202312200847441952.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/047202312200847446415.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/048202312200847447552.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/049202312200847443705.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/050202312200847444134.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/051202312200847443346.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/052202312200847448512.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/053202312200847446497.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/054202312200847445193.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/055202312200847444445.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/056202312200847443051.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/057202312200847448318.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/058202312200847449246.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/059202312200847441096.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/060202312200847449099.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/061202312200847440895.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/062202312200847448016.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/063202312200847447370.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/064202312200847440684.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/065202312200847443083.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/066202312200847440917.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/067202312200847451077.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/068202312200847453567.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/069202312200847459209.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/070202312200847457506.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/071202312200847450373.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/072202312200847451450.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/073202312200847453197.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/074202312200847455727.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/075202312200847455673.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/076202312200847450686.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/077202312200847457857.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/078202312200847454094.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/079202312200847453697.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/080202312200847453435.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/081202312200847451006.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/082202312200847452518.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/083202312200847456859.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/084202312200847455148.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/085202312200847457591.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/086202312200847456907.jpg\"><img class=\"txc-image\" style=\"clear: none; float: none; max-width:1000px;\" src=\"https://cdn.anytoon.co.kr/img/9207/24/087202312200847453071.jpg\"></p>";
        Pattern pattern = Pattern.compile("<img[^>]*src=[\"']?([^>\"']+)[\"']?[^>]*>"); //img 태그 src 추출 정규표현식
        Matcher matcher = pattern.matcher(text);

        System.out.println(IMG_PATH);

        while(matcher.find()){
            String group = matcher.group(1);

            String all = group.replaceAll("https://cdn.anytoon.co.kr/img", "");
            int lastIndex = all.lastIndexOf("/");
            String substring = all.substring(lastIndex+1);
            String path = all.substring(0, lastIndex+1);
        }
    }
}